{"version":3,"file":"library-config-5c3663be.js","sources":["../../blocks/library-config/library-config.js"],"sourcesContent":["import { createTag } from '../../scripts/scripts.js';\n\nconst LIBRARY_PATH = '/storybook/library.json';\n\nasync function loadBlocks(content, list) {\n  const { default: blocks } = await import('./lists/blocks.js');\n  blocks(content, list);\n}\n\nasync function loadPlaceholders(content, list) {\n  const { default: placeholders } = await import('./lists/placeholders.js');\n  placeholders(content, list);\n}\n\nasync function loadAssets(content, list) {\n  const { default: assets } = await import('./lists/assets.js');\n  assets(content, list);\n}\n\nasync function loadList(type, content, list) {\n  list.innerHTML = '';\n  switch (type) {\n    case 'blocks':\n      loadBlocks(content, list);\n      break;\n    case 'placeholders':\n      loadPlaceholders(content, list);\n      break;\n    case 'assets':\n      loadAssets(content, list);\n      break;\n    default:\n      console.log(`Library type not supported: ${type}`); // eslint-disable-line no-console\n  }\n}\n\nasync function fetchLibrary(domain) {\n  const { searchParams } = new URL(window.location.href);\n  const suppliedLibrary = searchParams.get('library');\n  const library = suppliedLibrary || `${domain}${LIBRARY_PATH}`;\n\n  const resp = await fetch(library);\n  if (!resp.ok) return null;\n  return resp.json();\n}\n\nasync function getSuppliedLibrary() {\n  const { searchParams } = new URL(window.location.href);\n  const repo = searchParams.get('repo');\n  const owner = searchParams.get('owner');\n  if (!repo || !owner) return null;\n  return fetchLibrary(`https://main--${repo}--${owner}.hlx.live`);\n}\n\nasync function fetchAssetsData(path) {\n  if (!path) return null;\n  const resp = await fetch(path);\n  if (!resp.ok) return null;\n\n  const json = await resp.json();\n  const assetHrefs = json.entities.map((entity) => entity.links[0].href);\n  return assetHrefs;\n}\n\nasync function combineLibraries(base, supplied) {\n  const url = new URL(window.location.href);\n\n  const assetsPath = url.searchParams.get('assets');\n\n  const library = {\n    blocks: base.blocks.data,\n    placeholders: base.placeholders?.data,\n    assets: await fetchAssetsData(assetsPath),\n  };\n\n  if (supplied) {\n    if (supplied.blocks.data.length > 0) {\n      library.blocks.push(...supplied.blocks.data);\n    }\n\n    if (supplied.placeholders.data.length > 0) {\n      library.placeholders = supplied.placeholders.data;\n    }\n  }\n\n  return library;\n}\n\nfunction createList(libraries) {\n  const container = createTag('div', { class: 'con-container' });\n\n  const libraryList = createTag('ul', { class: 'sk-library-list' });\n  container.append(libraryList);\n\n  Object.keys(libraries).forEach((type) => {\n    if (!libraries[type] || libraries[type].length === 0) return;\n\n    const item = createTag('li', { class: 'content-type' }, type);\n    libraryList.append(item);\n\n    const list = document.createElement('ul');\n    list.classList.add('con-type-list', `con-${type}-list`);\n    container.append(list);\n\n    item.addEventListener('click', (e) => {\n      const skLibrary = e.target.closest('.sk-library');\n      skLibrary.querySelector('.sk-library-title-text').textContent = type;\n      libraryList.classList.add('inset');\n      list.classList.add('inset');\n      skLibrary.classList.add('allow-back');\n      loadList(type, libraries[type], list);\n    });\n  });\n\n  return container;\n}\n\nfunction createHeader() {\n  const nav = createTag('button', { class: 'sk-library-logo' }, 'Franklin Library');\n  const title = createTag('div', { class: 'sk-library-title' }, nav);\n  title.append(createTag('p', { class: 'sk-library-title-text' }, 'Pick a library'));\n  const header = createTag('div', { class: 'sk-library-header' }, title);\n\n  nav.addEventListener('click', (e) => {\n    const skLibrary = e.target.closest('.sk-library');\n    skLibrary.querySelector('.sk-library-title-text').textContent = 'Pick a library';\n    const insetEls = skLibrary.querySelectorAll('.inset');\n    insetEls.forEach((el) => {\n      el.classList.remove('inset');\n    });\n    skLibrary.classList.remove('allow-back');\n  });\n  return header;\n}\n\nfunction detectContext() {\n  if (window.self === window.top) {\n    document.body.classList.add('in-page');\n  }\n}\n\nexport default async function init(el) {\n  el.querySelector('div').remove();\n  detectContext();\n\n  // Get the data\n  const base = await fetchLibrary(window.location.origin);\n  const supplied = await getSuppliedLibrary();\n  const libraries = await combineLibraries(base, supplied);\n\n  // Create the UI\n  const skLibrary = createTag('div', { class: 'sk-library' });\n\n  const header = createHeader();\n  skLibrary.append(header);\n\n  const list = createList(libraries);\n  skLibrary.append(list);\n  el.attachShadow({ mode: 'open' });\n\n  el.shadowRoot.append(skLibrary);\n\n  const link = document.createElement('link');\n  link.setAttribute('rel', 'stylesheet');\n  link.setAttribute('href', '/blocks/library-config/library-config.css');\n  el.shadowRoot.appendChild(link);\n}\n"],"names":["LIBRARY_PATH","loadBlocks","content","list","blocks","__vitePreload","loadPlaceholders","placeholders","loadAssets","assets","loadList","type","fetchLibrary","domain","searchParams","library","resp","getSuppliedLibrary","repo","owner","fetchAssetsData","path","entity","combineLibraries","base","supplied","assetsPath","createList","libraries","container","createTag","libraryList","item","e","skLibrary","createHeader","nav","title","header","el","detectContext","init","link"],"mappings":"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"}