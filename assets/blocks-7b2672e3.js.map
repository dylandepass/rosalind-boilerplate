{"version":3,"file":"blocks-7b2672e3.js","sources":["../../blocks/library-config/lists/blocks.js"],"sourcesContent":["import { createTag } from '../../../scripts/scripts.js';\nimport createCopy from '../library-utils.js';\n\nfunction getAuthorName(block) {\n  const blockSib = block.previousElementSibling;\n  if (!blockSib) return null;\n  if (['H2', 'H3'].includes(blockSib.nodeName)) {\n    return blockSib.textContent;\n  }\n  return null;\n}\n\nfunction getBlockName(block) {\n  const classes = block.className.split(' ');\n  const name = classes.shift();\n  return classes.length > 0 ? `${name} (${classes.join(', ')})` : name;\n}\n\nfunction getTable(block, name, path) {\n  const url = new URL(path);\n  block.querySelectorAll('img').forEach((img) => {\n    const srcSplit = img.src.split('/');\n    const mediaPath = srcSplit.pop();\n    img.src = `${url.origin}/${mediaPath}`;\n    const { width, height } = img;\n    const ratio = width > 200 ? 200 / width : 1;\n    img.width = width * ratio;\n    img.height = height * ratio;\n  });\n  const rows = [...block.children];\n  const maxCols = rows.reduce((cols, row) => (\n    row.children.length > cols ? row.children.length : cols), 0);\n  const table = document.createElement('table');\n  table.setAttribute('border', 1);\n  const headerRow = document.createElement('tr');\n  headerRow.append(createTag('th', { colspan: maxCols }, name));\n  table.append(headerRow);\n  rows.forEach((row) => {\n    const tr = document.createElement('tr');\n    [...row.children].forEach((col) => {\n      const td = document.createElement('td');\n      if (row.children.length < maxCols) {\n        td.setAttribute('colspan', maxCols);\n      }\n      td.innerHTML = col.innerHTML;\n      tr.append(td);\n    });\n    table.append(tr);\n  });\n  return table.outerHTML;\n}\n\nexport default async function loadBlocks(blocks, list) {\n  blocks.forEach(async (block) => {\n    const titleText = createTag('p', { class: 'item-title' }, block.name);\n    const title = createTag('li', { class: 'block-group' }, titleText);\n    const previewButton = createTag('button', { class: 'preview-group' }, 'Preview');\n    title.append(previewButton);\n    list.append(title);\n\n    const blockList = createTag('ul', { class: 'block-group-list' });\n    list.append(blockList);\n\n    title.addEventListener('click', () => {\n      title.classList.toggle('is-open');\n    });\n\n    previewButton.addEventListener('click', (e) => {\n      e.stopPropagation();\n      window.open(block.path, '_blockpreview');\n    });\n\n    const resp = await fetch(`${block.path}.plain.html`);\n    if (!resp.ok) return;\n\n    const html = await resp.text();\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const pageBlocks = doc.body.querySelectorAll('div[class]');\n    pageBlocks.forEach((pageBlock) => {\n      const item = document.createElement('li');\n      const name = document.createElement('p');\n      name.textContent = getAuthorName(pageBlock) || getBlockName(pageBlock);\n      const copy = document.createElement('button');\n      copy.addEventListener('click', (e) => {\n        const table = getTable(pageBlock, getBlockName(pageBlock), block.path);\n        e.target.classList.add('copied');\n        setTimeout(() => { e.target.classList.remove('copied'); }, 3000);\n        const blob = new Blob([table], { type: 'text/html' });\n        createCopy(blob);\n      });\n      item.append(name, copy);\n      blockList.append(item);\n    });\n  });\n}\n"],"names":["getAuthorName","block","blockSib","getBlockName","classes","name","getTable","path","url","img","mediaPath","width","height","ratio","rows","maxCols","cols","row","table","headerRow","createTag","tr","col","td","loadBlocks","blocks","list","titleText","title","previewButton","blockList","e","resp","html","pageBlock","item","copy","blob","createCopy"],"mappings":"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"}